<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bdu.laborder.mapper.LoginMapper">

	<resultMap type="com.bdu.laborder.common.core.domain.entity.SysUser" id="SysUserResult">
		<id     property="userId"       column="user_id"      />
		<result property="deptId"       column="dept_id"      />
		<result property="loginName"    column="login_name"   />
		<result property="password"     column="password"     />
		<result property="realName"     column="real_name"    />
		<result property="email"        column="email"        />
		<result property="mobile"       column="mobile"       />
		<result property="sex"          column="sex"          />
		<result property="avatar"       column="avatar"       />
		<result property="institute"    column="institute"    />
		<result property="major"        column="major"        />
		<result property="status"       column="status"       />
		<result property="delFlag"      column="del_flag"     />
		<result property="createBy"     column="create_by"    />
		<result property="createTime"   column="create_time"  />
		<result property="updateBy"     column="update_by"    />
		<result property="updateTime"   column="update_time"  />
		<association property="dept"    javaType="com.bdu.laborder.common.core.domain.entity.SysDept" resultMap="deptResult" />
		<collection  property="roles"   javaType="java.util.List"        resultMap="RoleResult" />
	</resultMap>

	<resultMap id="deptResult" type="com.bdu.laborder.common.core.domain.entity.SysDept">
		<id     property="deptId"   column="dept_id"     />
		<result property="parentId" column="parent_id"   />
		<result property="deptName" column="dept_name"   />
		<result property="orderNum" column="order_num"   />
		<result property="leader"   column="leader"      />
		<result property="status"   column="dept_status" />
	</resultMap>

	<resultMap id="RoleResult" type="com.bdu.laborder.common.core.domain.entity.SysRole">
		<id     property="roleId"       column="role_id"        />
		<result property="roleName"     column="role_name"      />
		<result property="roleKey"      column="role_key"       />
		<result property="dataScope"     column="data_scope"    />
		<result property="status"       column="role_status"    />
	</resultMap>

    <select id="getUserByUserName" resultType="com.bdu.laborder.common.core.domain.entity.SysUser">
		select user_id,login_name,password,is_firstlogin
		from s_user
		<where >
			1=1
		 	<if test="loginName!=null" >
				and login_name = #{loginName}
			</if>
		</where>
		and del_flag=0
		ORDER BY  user_id DESC limit 1
	</select>

	<select id="getUserById" parameterType="String" resultMap="SysUserResult">
		select *
		from s_user u
		left join s_user_role ur on u.user_id = ur.user_id
		left join s_role r on r.role_id = ur.role_id
		where u.del_flag = "0"
		<if test="userId != null" >
			and  u.user_id=#{userId}
		</if>
	</select>



</mapper>
